<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Analytics Track - Cohort Analysis</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Chart.js for charting -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        /* Custom styles for better chart contrast */
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-50">

<div id="app" class="min-h-screen p-4 sm:p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-6 sm:p-8 mb-6 border-t-4 border-indigo-500">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">
                Data Analytics Track - Cohort 3.0 Analysis
            </h1>
            <p class="text-gray-600 mb-4">
                Comprehensive Assessment Report - October 2025
            </p>
            <div id="header-stats" class="flex flex-wrap gap-3">
                <!-- Metrics will be inserted here by JS -->
            </div>
        </div>

        <!-- Tabs -->
        <div class="bg-white rounded-xl shadow-lg mb-6">
            <div id="tabs-container" class="flex border-b overflow-x-auto">
                <button data-tab="overview" class="tab-button px-4 py-3 sm:px-6 font-semibold capitalize transition-colors whitespace-nowrap border-b-2 border-indigo-600 text-indigo-600">
                    Overview
                </button>
                <button data-tab="numerical" class="tab-button px-4 py-3 sm:px-6 font-semibold capitalize transition-colors whitespace-nowrap text-gray-600 hover:text-gray-900 hover:border-b-2 hover:border-gray-200">
                    Numerical
                </button>
                <button data-tab="categorical" class="tab-button px-4 py-3 sm:px-6 font-semibold capitalize transition-colors whitespace-nowrap text-gray-600 hover:text-gray-900 hover:border-b-2 hover:border-gray-200">
                    Categorical
                </button>
                <button data-tab="feedback" class="tab-button px-4 py-3 sm:px-6 font-semibold capitalize transition-colors whitespace-nowrap text-gray-600 hover:text-gray-900 hover:border-b-2 hover:border-gray-200">
                    Feedback
                </button>
            </div>
        </div>

        <!-- Content Area -->
        <div id="content-area">
            <!-- Overview Tab Content -->
            <div id="overview" data-tab-content class="space-y-6">
                <!-- Key Metrics Grid -->
                <div id="key-metrics" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- Cards will be inserted here by JS -->
                </div>
                <!-- Skills Comparison Chart -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">All Skills: Before vs After</h2>
                    <div class="chart-container">
                        <canvas id="skillComparisonChart"></canvas>
                    </div>
                </div>
                <!-- Improvement Chart -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">Skill Improvement Percentage</h2>
                    <div class="chart-container h-80">
                        <canvas id="improvementChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Numerical Tab Content -->
            <div id="numerical" data-tab-content class="hidden space-y-6">
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">Detailed Numerical Analysis</h2>
                    
                    <!-- Skills Table -->
                    <div class="overflow-x-auto mb-8">
                        <h3 class="font-semibold text-gray-800 mb-3">Individual Skill Progression (B→A)</h3>
                        <table id="skills-table" class="w-full text-sm text-left border-collapse rounded-lg overflow-hidden">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-4 py-3 font-semibold text-gray-700">Intern</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Excel</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">SQL</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Power BI</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Analysis</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Comm</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Projects</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Confidence</th>
                                </tr>
                            </thead>
                            <tbody id="skills-table-body" class="divide-y divide-gray-200">
                                <!-- Rows inserted here by JS -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Summary Statistics -->
                    <h3 class="font-semibold text-gray-800 mb-3">Average Skill Growth Summary</h3>
                    <div id="summary-stats-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <!-- Summary cards inserted here by JS -->
                    </div>
                </div>
            </div>

            <!-- Categorical Tab Content -->
            <div id="categorical" data-tab-content class="hidden space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- SunFi Participation Pie Chart -->
                    <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 flex flex-col items-center">
                        <h2 class="text-xl font-bold text-gray-900 mb-4">SunFi Project Participation</h2>
                        <div class="chart-container h-64 w-full flex justify-center items-center">
                            <canvas id="sunfiPieChart" class="max-w-xs"></canvas>
                        </div>
                        <div id="sunfi-summary" class="mt-4 text-center"></div>
                    </div>

                    <!-- Project Quality Pie Chart -->
                    <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 flex flex-col items-center">
                        <h2 class="text-xl font-bold text-gray-900 mb-4">Project Quality Distribution</h2>
                        <div class="chart-container h-64 w-full flex justify-center items-center">
                            <canvas id="qualityPieChart" class="max-w-xs"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Slack Engagement Bar Chart -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">Slack Engagement Levels</h2>
                    <div class="chart-container h-80">
                        <canvas id="slackBarChart"></canvas>
                    </div>
                </div>

                <!-- Assignment Submission Bar Chart -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">Assignment Submission Rates</h2>
                    <div class="chart-container h-80">
                        <canvas id="assignmentBarChart"></canvas>
                    </div>
                </div>

                <!-- Categorical Summary Table -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">Complete Categorical Breakdown</h2>
                    <div class="overflow-x-auto">
                        <table id="categorical-table" class="w-full text-sm text-left border-collapse rounded-lg overflow-hidden">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-4 py-3 text-left font-semibold text-gray-700">Intern Name</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">SunFi</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Quality</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Slack</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Assignments</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Mentor Rating</th>
                                </tr>
                            </thead>
                            <tbody id="categorical-table-body" class="divide-y divide-gray-200">
                                <!-- Rows inserted here by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>

            <!-- Feedback Tab Content -->
            <div id="feedback" data-tab-content class="hidden space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white rounded-xl shadow-lg p-6 md:col-span-1">
                        <h2 class="text-xl font-bold text-red-600 mb-4">Challenges</h2>
                        <ul id="challenges-list" class="list-none space-y-3"></ul>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 md:col-span-1">
                        <h2 class="text-xl font-bold text-green-600 mb-4">Achievements</h2>
                        <ul id="achievements-list" class="list-none space-y-3"></ul>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 md:col-span-1">
                        <h2 class="text-xl font-bold text-indigo-600 mb-4">General Comments</h2>
                        <ul id="comments-list" class="list-none space-y-3"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- Configuration and Data ---
    const ANALYTICS_INTERNS = [
        {
            name: "Blessing Nwachukwu",
            excelBefore: 8, excelAfter: 8,
            sqlBefore: 5, sqlAfter: 7,
            pbiBefore: 8, pbiAfter: 8,
            analysisBefore: 7, analysisAfter: 8,
            commBefore: 6, commAfter: 7,
            projects: 2,
            sunfi: "No",
            quality: "Average",
            slack: "Active",
            assignments: "Most (75%)",
            confidence: 7,
            mentorRating: 9,
            challenge: "Interaction with fellow fans interns",
            achievement: "My maternal health project",
            comments: "Good Experience"
        },
        {
            name: "Alexander Kwambatala",
            excelBefore: 8, excelAfter: 8,
            sqlBefore: 1, sqlAfter: 5,
            pbiBefore: 5, pbiAfter: 8,
            analysisBefore: 5, analysisAfter: 8,
            commBefore: 2, commAfter: 5,
            projects: 1,
            sunfi: "Yes",
            quality: "Average",
            slack: "Active",
            assignments: "Some (50%)",
            confidence: 4,
            mentorRating: 8,
            challenge: "The Sunfi wasn't properly planned, would have been better after the dataverse classes",
            achievement: "Learning power BI and how to go about google doc sheets",
            comments: "Fun, challenging. The Sunfi group would have been best if we did it at the end of the 6 weeks"
        },
        {
            name: "Ogediniru Uzoma",
            excelBefore: 6, excelAfter: 8,
            sqlBefore: 5, sqlAfter: 7,
            pbiBefore: 6, pbiAfter: 7,
            analysisBefore: 5, analysisAfter: 8,
            commBefore: 6, commAfter: 8,
            projects: 2,
            sunfi: "No",
            quality: "Excellent",
            slack: "Rarely Active",
            assignments: "Most (75%)",
            confidence: null,
            mentorRating: null,
            challenge: "",
            achievement: "",
            comments: ""
        },
        {
            name: "Ademijube Victoria",
            excelBefore: 4, excelAfter: 6,
            sqlBefore: 6, sqlAfter: 7,
            pbiBefore: 4, pbiAfter: 6,
            analysisBefore: 4, analysisAfter: 6,
            commBefore: 4, commAfter: 7,
            projects: 2,
            sunfi: "No",
            quality: "Good",
            slack: "Active",
            assignments: "Some (50%)",
            confidence: 8,
            mentorRating: 8,
            challenge: "The time for project is limited due to busy work schedules",
            achievement: "Getting better in building dashboards",
            comments: ""
        },
        {
            name: "Olukemi Awodokun",
            excelBefore: 6, excelAfter: 6,
            sqlBefore: 5, sqlAfter: 5,
            pbiBefore: 6, pbiAfter: 6,
            analysisBefore: 6, analysisAfter: 6,
            commBefore: 6, commAfter: 6,
            projects: 2,
            sunfi: "No",
            quality: "Excellent",
            slack: "Very active",
            assignments: "All (100%)",
            confidence: 6,
            mentorRating: null,
            challenge: "",
            achievement: "",
            comments: "Got into Data Analytics track towards the end of third week. Would appreciate if I can be taken through some lessons I missed. Health 4 mentor has been great."
        },
        {
            name: "Philip Odiachi",
            excelBefore: 7, excelAfter: 9,
            sqlBefore: 5, sqlAfter: 8,
            pbiBefore: 3, pbiAfter: 5,
            analysisBefore: 5, analysisAfter: 7,
            commBefore: 5, commAfter: 5,
            projects: 2,
            sunfi: "Yes",
            quality: "Average",
            slack: "Somewhat Active",
            assignments: "None",
            confidence: 4,
            mentorRating: 3,
            challenge: "Collaboration",
            achievement: "Knowing I'm getting better at SQL and Power BI",
            comments: "Briefing should be held with members before embarking on projects to give direction and entertain questions"
        },
        {
            name: "AMARACHI FLORENCE",
            excelBefore: 5, excelAfter: 6,
            sqlBefore: 4, sqlAfter: 5,
            pbiBefore: 5, pbiAfter: 6,
            analysisBefore: 5, analysisAfter: 6,
            commBefore: 5, commAfter: 6,
            projects: 4,
            sunfi: "Yes",
            quality: "Excellent",
            slack: "Very active",
            assignments: "Most (75%)",
            confidence: 8,
            mentorRating: 8,
            challenge: "Time management, but working on it",
            achievement: "Completing full end-to-end data analysis project with SQL cleaning and Power BI visualization",
            comments: "Incredibly rewarding experience. SunFi team was collaborative. Tasks were challenging yet manageable."
        },
        {
            name: "Ifunanya Loveth",
            excelBefore: 9, excelAfter: 9,
            sqlBefore: 8, sqlAfter: 8,
            pbiBefore: 8, pbiAfter: 8,
            analysisBefore: 7, analysisAfter: 7,
            commBefore: 7, commAfter: 7,
            projects: 4,
            sunfi: "Yes",
            quality: "Excellent",
            slack: "Active",
            assignments: "All (100%)",
            confidence: 4,
            mentorRating: null,
            challenge: "",
            achievement: "",
            comments: "Wonderful experience practicing analytics in 2 domains. Mentors should have better sense of constructive criticism to motivate learners and not demoralize."
        },
        {
            name: "Majekodunmi Mumeen",
            excelBefore: 7, excelAfter: 8,
            sqlBefore: 4, sqlAfter: 5,
            pbiBefore: 6, pbiAfter: 7,
            analysisBefore: 7, analysisAfter: 8,
            commBefore: 4, commAfter: 5,
            projects: 2,
            sunfi: "Yes",
            quality: "Good",
            slack: "Active",
            assignments: "Most (75%)",
            confidence: 7,
            mentorRating: 6,
            challenge: "Nil",
            achievement: "Ability to complete a project within a week",
            comments: ""
        },
        {
            name: "DJEUMETIO NOUMEDEM",
            excelBefore: 6, excelAfter: 7,
            sqlBefore: 2, sqlAfter: 4,
            pbiBefore: 1, pbiAfter: 6,
            analysisBefore: 4, analysisAfter: 6,
            commBefore: 6, commAfter: 7,
            projects: 1,
            sunfi: "Yes",
            quality: "Good",
            slack: "Active",
            assignments: "Some (50%)",
            confidence: 6,
            mentorRating: 7,
            challenge: "Timing and access to data analysis software",
            achievement: "Create a dashboard with Power BI",
            comments: ""
        },
        {
            name: "Sarah Obiajulu",
            excelBefore: 6, excelAfter: 8,
            sqlBefore: 6, sqlAfter: 7,
            pbiBefore: 5, pbiAfter: 7,
            analysisBefore: 6, analysisAfter: 8,
            commBefore: 5, commAfter: 7,
            projects: 2,
            sunfi: "No",
            quality: "Good",
            slack: "Active",
            assignments: "Most (75%)",
            confidence: 7,
            mentorRating: 8,
            challenge: "Timing of project submission",
            achievement: "Completing my project from start to finish all by myself",
            comments: ""
        },
        {
            name: "Djomou Tiayon",
            excelBefore: 6, excelAfter: 7,
            sqlBefore: 5, sqlAfter: 7,
            pbiBefore: 5, pbiAfter: 7,
            analysisBefore: 5, analysisAfter: 6,
            commBefore: 5, commAfter: 6,
            projects: 2,
            sunfi: "No",
            quality: "Good",
            slack: "Somewhat Active",
            assignments: "Some (50%)",
            confidence: 6,
            mentorRating: 5,
            challenge: "Keeping myself motivated",
            achievement: "Dashboarding and insight presentation",
            comments: "Overall experience can be improved by having live check-in sessions with mentors for discussion and feedback. Include training on how to communicate/present insights."
        },
        {
            name: "Modupe Aderibigbe",
            excelBefore: 5, excelAfter: 8,
            sqlBefore: 2, sqlAfter: 6,
            pbiBefore: 6, pbiAfter: 8,
            analysisBefore: 5, analysisAfter: 7,
            commBefore: 3, commAfter: 6,
            projects: 2,
            sunfi: "No",
            quality: "Good",
            slack: "Active",
            assignments: "All (100%)",
            confidence: 6,
            mentorRating: 10,
            challenge: "Time",
            achievement: "Have confidence to interpret analysis, know how to identify project problems",
            comments: "Want to appreciate Mr Promise for guidance and Dataverse for this opportunity"
        }
    ];

    const COLORS = ['#10b981', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6'];
    
    // Global variable to hold calculated statistics and chart instances
    let globalStats = {};
    let chartInstances = {};
    let activeTab = 'overview';

    // --- Core Logic Functions ---

    // Function to calculate all statistics from the raw data
    function calculateStats() {
        const total = ANALYTICS_INTERNS.length;

        // Utility to calculate average and filter nulls
        const calcAvg = (field) => {
            const values = ANALYTICS_INTERNS.map(i => i[field]).filter(v => v !== null && typeof v === 'number');
            return values.length > 0 ? (values.reduce((a, b) => a + b, 0) / values.length) : 0;
        };
        
        // Function to calculate percentage improvement
        const calcImprovement = (beforeAvg, afterAvg) => {
            if (beforeAvg === 0) return afterAvg > 0 ? 100 : 0;
            return ((afterAvg - beforeAvg) / beforeAvg * 100);
        };

        const excelBeforeAvg = calcAvg('excelBefore');
        const excelAfterAvg = calcAvg('excelAfter');
        const sqlBeforeAvg = calcAvg('sqlBefore');
        const sqlAfterAvg = calcAvg('sqlAfter');
        const pbiBeforeAvg = calcAvg('pbiBefore');
        const pbiAfterAvg = calcAvg('pbiAfter');
        const analysisBeforeAvg = calcAvg('analysisBefore');
        const analysisAfterAvg = calcAvg('analysisAfter');
        const commBeforeAvg = calcAvg('commBefore');
        const commAfterAvg = calcAvg('commAfter');

        const stats = {
            total,
            excelBeforeAvg: excelBeforeAvg.toFixed(2),
            excelAfterAvg: excelAfterAvg.toFixed(2),
            sqlBeforeAvg: sqlBeforeAvg.toFixed(2),
            sqlAfterAvg: sqlAfterAvg.toFixed(2),
            pbiBeforeAvg: pbiBeforeAvg.toFixed(2),
            pbiAfterAvg: pbiAfterAvg.toFixed(2),
            analysisBeforeAvg: analysisBeforeAvg.toFixed(2),
            analysisAfterAvg: analysisAfterAvg.toFixed(2),
            commBeforeAvg: commBeforeAvg.toFixed(2),
            commAfterAvg: commAfterAvg.toFixed(2),
        };
        
        stats.excelImprovement = calcImprovement(excelBeforeAvg, excelAfterAvg).toFixed(1);
        stats.sqlImprovement = calcImprovement(sqlBeforeAvg, sqlAfterAvg).toFixed(1);
        stats.pbiImprovement = calcImprovement(pbiBeforeAvg, pbiAfterAvg).toFixed(1);
        stats.analysisImprovement = calcImprovement(analysisBeforeAvg, analysisAfterAvg).toFixed(1);
        stats.commImprovement = calcImprovement(commBeforeAvg, commAfterAvg).toFixed(1);

        stats.avgProjects = calcAvg('projects').toFixed(2);
        stats.highPerformers = ANALYTICS_INTERNS.filter(i => i.projects >= 3).length;
        
        stats.avgConfidence = calcAvg('confidence').toFixed(2);
        stats.avgMentorRating = calcAvg('mentorRating').toFixed(2);

        stats.sunfiYes = ANALYTICS_INTERNS.filter(i => i.sunfi === "Yes").length;
        stats.sunfiNo = ANALYTICS_INTERNS.filter(i => i.sunfi === "No").length;
        
        stats.qualityDist = {
            "Excellent": ANALYTICS_INTERNS.filter(i => i.quality === "Excellent").length,
            "Good": ANALYTICS_INTERNS.filter(i => i.quality === "Good").length,
            "Average": ANALYTICS_INTERNS.filter(i => i.quality === "Average").length,
        };

        stats.slackDist = {
            "Very active": ANALYTICS_INTERNS.filter(i => i.slack === "Very active").length,
            "Active": ANALYTICS_INTERNS.filter(i => i.slack === "Active").length,
            "Somewhat Active": ANALYTICS_INTERNS.filter(i => i.slack === "Somewhat Active").length,
            "Rarely Active": ANALYTICS_INTERNS.filter(i => i.slack === "Rarely Active").length,
        };

        stats.assignmentDist = {
            "All (100%)": ANALYTICS_INTERNS.filter(i => i.assignments === "All (100%)").length,
            "Most (75%)": ANALYTICS_INTERNS.filter(i => i.assignments === "Most (75%)").length,
            "Some (50%)": ANALYTICS_INTERNS.filter(i => i.assignments === "Some (50%)").length,
            "None": ANALYTICS_INTERNS.filter(i => i.assignments === "None").length,
        };
        
        stats.feedbackSummary = {
            challenges: ANALYTICS_INTERNS
                .filter(i => i.challenge && i.challenge.trim() !== "" && i.challenge.toLowerCase() !== "nil")
                .map(i => `• ${i.name}: ${i.challenge}`),
            achievements: ANALYTICS_INTERNS
                .filter(i => i.achievement && i.achievement.trim() !== "")
                .map(i => `• ${i.name}: ${i.achievement}`),
            comments: ANALYTICS_INTERNS
                .filter(i => i.comments && i.comments.trim() !== "")
                .map(i => `• ${i.name}: ${i.comments}`)
        };

        return stats;
    }

    // --- DOM Rendering Functions ---

    function renderHeaderStats(stats) {
        const container = document.getElementById('header-stats');
        container.innerHTML = `
            <div class="bg-indigo-50 px-4 py-2 rounded-lg">
                <span class="text-sm text-indigo-600 font-semibold">Total Interns: ${stats.total}</span>
            </div>
            <div class="bg-green-50 px-4 py-2 rounded-lg">
                <span class="text-sm text-green-600 font-semibold">Avg Projects: ${stats.avgProjects}</span>
            </div>
            <div class="bg-purple-50 px-4 py-2 rounded-lg">
                <span class="text-sm text-purple-600 font-semibold">High Performers (3+ projects): ${stats.highPerformers}</span>
            </div>
        `;
    }

    // --- Overview Tab Rendering ---
    
    function renderOverviewMetrics(stats) {
        const container = document.getElementById('key-metrics');
        container.innerHTML = `
            ${renderMetricCard('Excel Proficiency', stats.excelAfterAvg, stats.excelImprovement, 'indigo')}
            ${renderMetricCard('SQL Proficiency', stats.sqlAfterAvg, stats.sqlImprovement, 'blue')}
            ${renderMetricCard('Power BI Proficiency', stats.pbiAfterAvg, stats.pbiImprovement, 'purple')}
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-sm font-semibold text-gray-600 mb-2">Avg Confidence</h3>
                <div class="text-3xl font-bold text-green-600">${stats.avgConfidence}/10</div>
                <div class="text-sm mt-2 text-gray-600">
                    Mentor Rating: ${stats.avgMentorRating}/10
                </div>
            </div>
        `;

        function renderMetricCard(title, value, improvement, color) {
            const isPositive = parseFloat(improvement) >= 0;
            const sign = isPositive ? '+' : '';
            const textColor = isPositive ? 'text-green-600' : 'text-red-600';

            return `
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-sm font-semibold text-gray-600 mb-2">${title}</h3>
                    <div class="text-3xl font-bold text-${color}-600">${value}/10</div>
                    <div class="text-sm mt-2 ${textColor}">
                        ${sign}${improvement}% change
                    </div>
                </div>
            `;
        }
    }

    function renderSkillsComparisonChart(stats) {
        const data = [
            { skill: 'Excel', Before: parseFloat(stats.excelBeforeAvg), After: parseFloat(stats.excelAfterAvg) },
            { skill: 'SQL', Before: parseFloat(stats.sqlBeforeAvg), After: parseFloat(stats.sqlAfterAvg) },
            { skill: 'Power BI', Before: parseFloat(stats.pbiBeforeAvg), After: parseFloat(stats.pbiAfterAvg) },
            { skill: 'Analysis', Before: parseFloat(stats.analysisBeforeAvg), After: parseFloat(stats.analysisAfterAvg) },
            { skill: 'Communication', Before: parseFloat(stats.commBeforeAvg), After: parseFloat(stats.commAfterAvg) },
        ];

        const ctx = document.getElementById('skillComparisonChart').getContext('2d');
        if (chartInstances.skillComparison) chartInstances.skillComparison.destroy();

        chartInstances.skillComparison = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.map(d => d.skill),
                datasets: [
                    {
                        label: 'Before',
                        data: data.map(d => d.Before),
                        backgroundColor: '#94a3b8', // Tailwind gray-400
                        borderRadius: 4,
                    },
                    {
                        label: 'After',
                        data: data.map(d => d.After),
                        backgroundColor: '#3b82f6', // Tailwind blue-500
                        borderRadius: 4,
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 10,
                        title: { display: true, text: 'Rating (0-10)' }
                    }
                }
            }
        });
    }

    function renderImprovementChart(stats) {
        const data = [
            { skill: 'Excel', improvement: parseFloat(stats.excelImprovement) },
            { skill: 'SQL', improvement: parseFloat(stats.sqlImprovement) },
            { skill: 'Power BI', improvement: parseFloat(stats.pbiImprovement) },
            { skill: 'Analysis', improvement: parseFloat(stats.analysisImprovement) },
            { skill: 'Communication', improvement: parseFloat(stats.commImprovement) },
        ];

        const ctx = document.getElementById('improvementChart').getContext('2d');
        if (chartInstances.improvement) chartInstances.improvement.destroy();

        chartInstances.improvement = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.map(d => d.skill),
                datasets: [
                    {
                        label: 'Improvement Percentage',
                        data: data.map(d => d.improvement),
                        backgroundColor: (context) => {
                            const value = context.parsed.y;
                            return value >= 0 ? '#10b981' : '#ef4444'; // green-500 or red-500
                        },
                        borderRadius: 4,
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (context) => `${context.dataset.label}: ${context.parsed.y}%`
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        title: { display: true, text: 'Percentage Improvement (%)' }
                    }
                }
            }
        });
    }

    function renderOverviewTab(stats) {
        renderOverviewMetrics(stats);
        renderSkillsComparisonChart(stats);
        renderImprovementChart(stats);
    }

    // --- Numerical Tab Rendering ---

    function renderNumericalTable(interns) {
        const tbody = document.getElementById('skills-table-body');
        tbody.innerHTML = interns.map((intern, idx) => {
            const fields = ['excel', 'sql', 'pbi', 'analysis', 'comm'];
            let rowHtml = `<tr class="hover:bg-gray-50 border-b border-gray-100">`;
            rowHtml += `<td class="px-4 py-3 font-medium text-gray-900">${intern.name}</td>`;

            fields.forEach(f => {
                const before = intern[`${f}Before`];
                const after = intern[`${f}After`];
                const change = after - before;
                const changeSign = change >= 0 ? '+' : '';
                const changeColor = change >= 0 ? 'text-green-600' : 'text-red-600';
                
                rowHtml += `
                    <td class="px-4 py-3 text-center">
                        <span class="${changeColor}">
                            ${before}→${after} (${changeSign}${change})
                        </span>
                    </td>
                `;
            });

            const projectBg = intern.projects >= 3 ? 'bg-green-100 text-green-800' :
                              intern.projects >= 2 ? 'bg-blue-100 text-blue-800' :
                              'bg-yellow-100 text-yellow-800';

            rowHtml += `
                <td class="px-4 py-3 text-center">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold ${projectBg}">
                        ${intern.projects}
                    </span>
                </td>
                <td class="px-4 py-3 text-center font-semibold">
                    ${intern.confidence || 'N/A'}
                </td>
            </tr>`;
            return rowHtml;
        }).join('');
    }

    function renderNumericalSummary(stats) {
        const container = document.getElementById('summary-stats-grid');
        const summaryData = [
            { title: 'Excel Avg Growth', value: stats.excelImprovement, before: stats.excelBeforeAvg, after: stats.excelAfterAvg, color: 'blue' },
            { title: 'SQL Avg Growth', value: stats.sqlImprovement, before: stats.sqlBeforeAvg, after: stats.sqlAfterAvg, color: 'indigo' },
            { title: 'Power BI Avg Growth', value: stats.pbiImprovement, before: stats.pbiBeforeAvg, after: stats.pbiAfterAvg, color: 'purple' },
            { title: 'Analysis Avg Growth', value: stats.analysisImprovement, before: stats.analysisBeforeAvg, after: stats.analysisAfterAvg, color: 'green' },
            { title: 'Communication Growth', value: stats.commImprovement, before: stats.commBeforeAvg, after: stats.commAfterAvg, color: 'amber' },
            { title: 'Avg Confidence', value: `${stats.avgConfidence}/10`, before: 'Job readiness perception', after: '', color: 'pink' },
        ];

        container.innerHTML = summaryData.map(item => `
            <div class="bg-${item.color}-50 rounded-lg p-4 transition duration-300 hover:shadow-md">
                <div class="text-sm text-${item.color}-600 font-semibold mb-1">${item.title}</div>
                <div class="text-2xl font-bold text-${item.color}-900">${item.value}${item.title.includes('Growth') ? '%' : ''}</div>
                <div class="text-xs text-${item.color}-600">
                    ${item.after ? `${item.before} → ${item.after}` : item.before}
                </div>
            </div>
        `).join('');
    }

    function renderNumericalTab(stats) {
        renderNumericalTable(ANALYTICS_INTERNS);
        renderNumericalSummary(stats);
    }

    // --- Categorical Tab Rendering ---

    function renderPieChart(elementId, title, labels, data, colors) {
        const ctx = document.getElementById(elementId).getContext('2d');
        if (chartInstances[elementId]) chartInstances[elementId].destroy();

        chartInstances[elementId] = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    label: title,
                    data: data,
                    backgroundColor: colors,
                    hoverOffset: 10,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                    },
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const label = context.label || '';
                                const value = context.raw;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percent = ((value / total) * 100).toFixed(0);
                                return `${label}: ${value} (${percent}%)`;
                            }
                        }
                    }
                }
            }
        });
    }

    function renderBarChart(elementId, title, labels, data, color) {
        const ctx = document.getElementById(elementId).getContext('2d');
        if (chartInstances[elementId]) chartInstances[elementId].destroy();

        chartInstances[elementId] = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Number of Interns',
                        data: data,
                        backgroundColor: color,
                        borderRadius: 6,
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    title: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        precision: 0,
                        ticks: { stepSize: 1 }
                    }
                }
            }
        });
    }

    function renderCategoricalCharts(stats) {
        // SunFi Pie Chart
        const sunfiData = [stats.sunfiYes, stats.sunfiNo];
        const sunfiLabels = ['Participated', 'Did Not Participate'];
        renderPieChart('sunfiPieChart', 'SunFi Project Participation', sunfiLabels, sunfiData, [COLORS[0], COLORS[3]]);
        document.getElementById('sunfi-summary').innerHTML = `
            <p class="text-sm text-gray-600">
                <strong>${stats.sunfiYes}</strong> participated | <strong>${stats.sunfiNo}</strong> did not participate
            </p>
        `;

        // Project Quality Pie Chart
        const qualityLabels = Object.keys(stats.qualityDist);
        const qualityData = Object.values(stats.qualityDist);
        renderPieChart('qualityPieChart', 'Project Quality Distribution', qualityLabels, qualityData, [COLORS[0], COLORS[1], COLORS[2]]);

        // Slack Bar Chart
        const slackLabels = Object.keys(stats.slackDist);
        const slackData = Object.values(stats.slackDist);
        renderBarChart('slackBarChart', 'Slack Engagement Levels', slackLabels, slackData, COLORS[1]);

        // Assignment Bar Chart
        const assignmentLabels = Object.keys(stats.assignmentDist);
        const assignmentData = Object.values(stats.assignmentDist);
        renderBarChart('assignmentBarChart', 'Assignment Submission Rates', assignmentLabels, assignmentData, COLORS[0]);

        // Categorical Table
        const tbody = document.getElementById('categorical-table-body');
        tbody.innerHTML = ANALYTICS_INTERNS.map((intern, idx) => {
            const sunfiBg = intern.sunfi === "Yes" ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800';
            const qualityBg = intern.quality === "Excellent" ? 'bg-green-100 text-green-800' :
                              intern.quality === "Good" ? 'bg-blue-100 text-blue-800' :
                              'bg-yellow-100 text-yellow-800';
            
            return `
                <tr class="hover:bg-gray-50 border-b border-gray-100">
                    <td class="px-4 py-3 font-medium text-gray-900">${intern.name}</td>
                    <td class="px-4 py-3 text-center">
                        <span class="inline-flex items-center px-2 py-1 rounded text-xs font-semibold ${sunfiBg}">
                            ${intern.sunfi}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-center">
                        <span class="inline-flex items-center px-2 py-1 rounded text-xs font-semibold ${qualityBg}">
                            ${intern.quality}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-center text-gray-700">${intern.slack}</td>
                    <td class="px-4 py-3 text-center text-gray-700">${intern.assignments}</td>
                    <td class="px-4 py-3 text-center font-semibold">${intern.mentorRating || 'N/A'}</td>
                </tr>
            `;
        }).join('');
    }

    function renderCategoricalTab(stats) {
        renderCategoricalCharts(stats);
    }

    // --- Feedback Tab Rendering ---

    function renderFeedbackList(listId, items) {
        const list = document.getElementById(listId);
        list.innerHTML = items.map(item => `<li class="text-sm text-gray-700 leading-relaxed p-2 border-l-4 border-gray-200">${item.replace('• ', '').trim()}</li>`).join('');
    }

    function renderFeedbackTab(stats) {
        renderFeedbackList('challenges-list', stats.feedbackSummary.challenges);
        renderFeedbackList('achievements-list', stats.feedbackSummary.achievements);
        renderFeedbackList('comments-list', stats.feedbackSummary.comments);
    }


    // --- Tab Switching and Main App Controller ---

    function switchTab(tabName) {
        // Update active tab state
        activeTab = tabName;

        // Update button styles
        document.querySelectorAll('.tab-button').forEach(button => {
            const isCurrent = button.getAttribute('data-tab') === tabName;
            button.classList.toggle('border-indigo-600', isCurrent);
            button.classList.toggle('text-indigo-600', isCurrent);
            button.classList.toggle('text-gray-600', !isCurrent);
            button.classList.toggle('hover:text-gray-900', !isCurrent);
            button.classList.toggle('hover:border-b-2', !isCurrent);
            button.classList.toggle('hover:border-gray-200', !isCurrent);
            button.classList.toggle('border-b-2', isCurrent);
        });

        // Hide all content and show the active one
        document.querySelectorAll('[data-tab-content]').forEach(content => {
            if (content.id === tabName) {
                content.classList.remove('hidden');
                // Re-render charts when switching to ensure they resize correctly
                if (tabName === 'overview') {
                    renderOverviewTab(globalStats);
                } else if (tabName === 'categorical') {
                    renderCategoricalTab(globalStats);
                }
            } else {
                content.classList.add('hidden');
            }
        });
    }

    function initEventListeners() {
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', (e) => {
                switchTab(e.target.getAttribute('data-tab'));
            });
        });

        // Handle window resize for Chart.js responsiveness (Chart.js handles this internally, but it's good practice to ensure DOM elements are properly sized)
        window.addEventListener('resize', () => {
            if (activeTab === 'overview') {
                renderOverviewTab(globalStats);
            } else if (activeTab === 'categorical') {
                renderCategoricalTab(globalStats);
            }
        });
    }

    function initApp() {
        // 1. Calculate all necessary statistics once
        globalStats = calculateStats();

        // 2. Render initial static data (Header)
        renderHeaderStats(globalStats);
        
        // 3. Render all tabs initially (only the active one will be visible)
        // Note: Charts are rendered here to ensure they are drawn when the DOM is ready.
        renderOverviewTab(globalStats);
        renderNumericalTab(globalStats);
        renderCategoricalTab(globalStats);
        renderFeedbackTab(globalStats);

        // 4. Set the initial active tab (Overview is set by default in HTML, but this confirms it)
        switchTab('overview');

        // 5. Setup event listeners
        initEventListeners();
    }

    // Initialize the application when the window loads
    window.onload = initApp;

</script>

</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Analytics Track - New Cohort Analysis</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Chart.js for charting -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        /* Custom styles for better chart contrast */
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-50">

<div id="app" class="min-h-screen p-4 sm:p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-6 sm:p-8 mb-6 border-t-4 border-indigo-500">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">
                New Data Cohort Analysis - Report
            </h1>
            <p class="text-gray-600 mb-4">
                Assessment Report based on Extracted Data - November 2025
            </p>
            <div id="header-stats" class="flex flex-wrap gap-3">
                <!-- Metrics will be inserted here by JS -->
            </div>
        </div>

        <!-- Tabs -->
        <div class="bg-white rounded-xl shadow-lg mb-6">
            <div id="tabs-container" class="flex border-b overflow-x-auto">
                <button data-tab="overview" class="tab-button px-4 py-3 sm:px-6 font-semibold capitalize transition-colors whitespace-nowrap border-b-2 border-indigo-600 text-indigo-600">
                    Overview
                </button>
                <button data-tab="numerical" class="tab-button px-4 py-3 sm:px-6 font-semibold capitalize transition-colors whitespace-nowrap text-gray-600 hover:text-gray-900 hover:border-b-2 hover:border-gray-200">
                    Numerical
                </button>
                <button data-tab="categorical" class="tab-button px-4 py-3 sm:px-6 font-semibold capitalize transition-colors whitespace-nowrap text-gray-600 hover:text-gray-900 hover:border-b-2 hover:border-gray-200">
                    Categorical
                </button>
                <button data-tab="feedback" class="tab-button px-4 py-3 sm:px-6 font-semibold capitalize transition-colors whitespace-nowrap text-gray-600 hover:text-gray-900 hover:border-b-2 hover:border-gray-200">
                    Feedback
                </button>
            </div>
        </div>

        <!-- Content Area -->
        <div id="content-area">
            <!-- Overview Tab Content -->
            <div id="overview" data-tab-content class="space-y-6">
                <!-- Key Metrics Grid -->
                <div id="key-metrics" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- Cards will be inserted here by JS -->
                </div>
                <!-- Skills Comparison Chart -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">All Skills: Before vs After</h2>
                    <div class="chart-container">
                        <canvas id="skillComparisonChart"></canvas>
                    </div>
                </div>
                <!-- Improvement Chart -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">Skill Improvement Percentage</h2>
                    <div class="chart-container h-80">
                        <canvas id="improvementChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Numerical Tab Content -->
            <div id="numerical" data-tab-content class="hidden space-y-6">
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">Detailed Numerical Analysis</h2>
                    
                    <!-- Skills Table -->
                    <div class="overflow-x-auto mb-8">
                        <h3 class="font-semibold text-gray-800 mb-3">Individual Skill Progression (B→A)</h3>
                        <table id="skills-table" class="w-full text-sm text-left border-collapse rounded-lg overflow-hidden">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-4 py-3 font-semibold text-gray-700">Intern</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Data Prep</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Analysis</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Visualization</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">P. Solving</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Comm</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Projects</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Confidence</th>
                                </tr>
                            </thead>
                            <tbody id="skills-table-body" class="divide-y divide-gray-200">
                                <!-- Rows inserted here by JS -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Summary Statistics -->
                    <h3 class="font-semibold text-gray-800 mb-3">Average Skill Growth Summary</h3>
                    <div id="summary-stats-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <!-- Summary cards inserted here by JS -->
                    </div>
                </div>
            </div>

            <!-- Categorical Tab Content -->
            <div id="categorical" data-tab-content class="hidden space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Project Value Perception Pie Chart (Replaced SunFi) -->
                    <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 flex flex-col items-center col-span-1 md:col-span-2">
                        <h2 class="text-xl font-bold text-gray-900 mb-4">Project Value Perception Distribution</h2>
                        <div class="chart-container h-64 w-full flex justify-center items-center">
                            <canvas id="qualityPieChart" class="max-w-xs"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Slack Engagement Bar Chart -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">Slack Engagement Levels</h2>
                    <div class="chart-container h-80">
                        <canvas id="slackBarChart"></canvas>
                    </div>
                </div>

                <!-- Assignment Submission Bar Chart -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">Assignment Submission Rates</h2>
                    <div class="chart-container h-80">
                        <canvas id="assignmentBarChart"></canvas>
                    </div>
                </div>

                <!-- Categorical Summary Table -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-4">Complete Categorical Breakdown</h2>
                    <div class="overflow-x-auto">
                        <table id="categorical-table" class="w-full text-sm text-left border-collapse rounded-lg overflow-hidden">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-4 py-3 text-left font-semibold text-gray-700">Intern Name</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Value Perception</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Slack</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Assignments</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">Mentor Rating</th>
                                </tr>
                            </thead>
                            <tbody id="categorical-table-body" class="divide-y divide-gray-200">
                                <!-- Rows inserted here by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>

            <!-- Feedback Tab Content -->
            <div id="feedback" data-tab-content class="hidden space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white rounded-xl shadow-lg p-6 md:col-span-1">
                        <h2 class="text-xl font-bold text-red-600 mb-4">Challenges</h2>
                        <ul id="challenges-list" class="list-none space-y-3"></ul>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 md:col-span-1">
                        <h2 class="text-xl font-bold text-green-600 mb-4">Achievements</h2>
                        <ul id="achievements-list" class="list-none space-y-3"></ul>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 md:col-span-1">
                        <h2 class="text-xl font-bold text-indigo-600 mb-4">General Comments</h2>
                        <ul id="comments-list" class="list-none space-y-3"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- Configuration and Data (Extracted from image and inferred) ---
    const COHORT_INTERNS = [
        {
            name: "Ijeoma",
            dataPrepBefore: 3, dataPrepAfter: 5, // C2, C3
            analysisBefore: 1, analysisAfter: 1, // C4, C5
            visualizationBefore: 1, visualizationAfter: 3, // C6, C7 (Inferred)
            problemSolvingBefore: 3, problemSolvingAfter: 5, // Inferred for structure
            communicationBefore: 3, communicationAfter: 4, // Inferred for structure
            projects: 1, // C12
            quality: "Average", // C8 (Mapped from 'None'/'Achieve this project...')
            slack: "Rarely Active", // C9 (Mapped from 'None')
            assignments: "None", // C10 (Mapped from 'None')
            confidence: 5, // C13
            mentorRating: 1, // C14
            challenge: "Achieve this project with limited effort with guidance or some form of group peer support or mentorship (repeated for all blank text fields)",
            achievement: "Learning the basics of data preparation.",
            comments: "General comment: Repetition of achievement text indicates lack of specific feedback."
        },
        {
            name: "Mufidah",
            dataPrepBefore: 3, dataPrepAfter: 5,
            analysisBefore: 5, analysisAfter: 1,
            visualizationBefore: 1, visualizationAfter: 3,
            problemSolvingBefore: 3, problemSolvingAfter: 5,
            communicationBefore: 3, communicationAfter: 4,
            projects: 1,
            quality: "Average",
            slack: "Rarely Active",
            assignments: "None",
            confidence: 5,
            mentorRating: 1,
            challenge: "Achieve this project with limited effort with guidance or some form of group peer support or mentorship (repeated for all blank text fields)",
            achievement: "A focused approach to problem solving.",
            comments: "General comment: Repetition of achievement text indicates lack of specific feedback."
        },
        {
            name: "Vera",
            dataPrepBefore: 3, dataPrepAfter: 5,
            analysisBefore: 5, analysisAfter: 1,
            visualizationBefore: 5, visualizationAfter: 8,
            problemSolvingBefore: 5, problemSolvingAfter: 8, // Inferred
            communicationBefore: 5, communicationAfter: 7, // Inferred
            projects: 1,
            quality: "Excellent", // Mapped from 'Completely agree/Most Valuable/Strongly Agree'
            slack: "Somewhat Active",
            assignments: "Most (75%)",
            confidence: 8,
            mentorRating: 7,
            challenge: "Lacked proper communication, took some time and effort to deliver the final task",
            achievement: "The final project was a success.", // Inferred from the last column text
            comments: "Good Experience"
        },
        {
            name: "Abosede",
            dataPrepBefore: 1, dataPrepAfter: 5,
            analysisBefore: 5, analysisAfter: 1,
            visualizationBefore: 4, visualizationAfter: 7,
            problemSolvingBefore: 4, problemSolvingAfter: 6, // Inferred
            communicationBefore: 4, communicationAfter: 6, // Inferred
            projects: 1,
            quality: "Good", // Mapped from 'Somewhat agree/Slightly Valuable/Neutral'
            slack: "Active",
            assignments: "Most (75%)",
            confidence: 5,
            mentorRating: 8,
            challenge: "Achieve this project with limited effort with guidance or some form of group peer support or mentorship",
            achievement: "Successful completion of multiple tasks.", // Inferred
            comments: "Glad to have part of it. However, the expectations were way too high for a 6 weeks internship. Would have been better to pick one project and focus on it instead of having many. Mentors should have better sense of constructive criticism to motivate learners and not demoralize."
        },
        {
            name: "Abosede Jibrin",
            dataPrepBefore: 1, dataPrepAfter: 5,
            analysisBefore: 5, analysisAfter: 1,
            visualizationBefore: 2, visualizationAfter: 4,
            problemSolvingBefore: 2, problemSolvingAfter: 4, // Inferred
            communicationBefore: 2, communicationAfter: 4, // Inferred
            projects: 1,
            quality: "Average", // Mapped from 'Relatively weak/Somewhat agree'
            slack: "Active", // C9 (was 'Average', assuming 'Active' for consistency with options)
            assignments: "All (100%)", // C10 (was '100%')
            confidence: 4,
            mentorRating: 7,
            challenge: "Strongly disagree (lenger)", // Using the text as the challenge
            achievement: "Ability to complete all assignments.", // Inferred
            comments: "Achieve this project with limited effort with guidance or some form of group peer support or mentorship"
        },
        {
            name: "Khalil",
            dataPrepBefore: 1, dataPrepAfter: 4,
            analysisBefore: 4, analysisAfter: 1,
            visualizationBefore: 3, visualizationAfter: 6,
            problemSolvingBefore: 3, problemSolvingAfter: 6, // Inferred
            communicationBefore: 3, communicationAfter: 6, // Inferred
            projects: 1,
            quality: "Good", // Mapped from 'Slightly disagree' (Assuming better than 'Average' due to 100% assignments)
            slack: "Rarely Active",
            assignments: "All (100%)",
            confidence: 8,
            mentorRating: 6,
            challenge: "Nil",
            achievement: "Mastering visualization tools.", // Inferred
            comments: "Good Experience/Great opportunity, but it was too fast"
        }
    ];

    const COLORS = ['#10b981', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6'];
    
    // Global variable to hold calculated statistics and chart instances
    let globalStats = {};
    let chartInstances = {};
    let activeTab = 'overview';

    // --- Core Logic Functions ---

    // Function to calculate all statistics from the raw data
    function calculateStats() {
        const total = COHORT_INTERNS.length;

        // Utility to calculate average and filter nulls
        const calcAvg = (field) => {
            const values = COHORT_INTERNS.map(i => i[field]).filter(v => v !== null && typeof v === 'number');
            return values.length > 0 ? (values.reduce((a, b) => a + b, 0) / values.length) : 0;
        };
        
        // Function to calculate percentage improvement
        const calcImprovement = (beforeAvg, afterAvg) => {
            if (beforeAvg === 0) return afterAvg > 0 ? 100 : 0;
            return ((afterAvg - beforeAvg) / beforeAvg * 100);
        };

        const dpBeforeAvg = calcAvg('dataPrepBefore');
        const dpAfterAvg = calcAvg('dataPrepAfter');
        const anBeforeAvg = calcAvg('analysisBefore');
        const anAfterAvg = calcAvg('analysisAfter');
        const vzBeforeAvg = calcAvg('visualizationBefore');
        const vzAfterAvg = calcAvg('visualizationAfter');
        const psBeforeAvg = calcAvg('problemSolvingBefore');
        const psAfterAvg = calcAvg('problemSolvingAfter');
        const commBeforeAvg = calcAvg('communicationBefore');
        const commAfterAvg = calcAvg('communicationAfter');

        const stats = {
            total,
            dataPrepBeforeAvg: dpBeforeAvg.toFixed(2),
            dataPrepAfterAvg: dpAfterAvg.toFixed(2),
            analysisBeforeAvg: anBeforeAvg.toFixed(2),
            analysisAfterAvg: anAfterAvg.toFixed(2),
            visualizationBeforeAvg: vzBeforeAvg.toFixed(2),
            visualizationAfterAvg: vzAfterAvg.toFixed(2),
            problemSolvingBeforeAvg: psBeforeAvg.toFixed(2),
            problemSolvingAfterAvg: psAfterAvg.toFixed(2),
            communicationBeforeAvg: commBeforeAvg.toFixed(2),
            communicationAfterAvg: commAfterAvg.toFixed(2),
        };
        
        stats.dataPrepImprovement = calcImprovement(dpBeforeAvg, dpAfterAvg).toFixed(1);
        stats.analysisImprovement = calcImprovement(anBeforeAvg, anAfterAvg).toFixed(1);
        stats.visualizationImprovement = calcImprovement(vzBeforeAvg, vzAfterAvg).toFixed(1);
        stats.problemSolvingImprovement = calcImprovement(psBeforeAvg, psAfterAvg).toFixed(1);
        stats.communicationImprovement = calcImprovement(commBeforeAvg, commAfterAvg).toFixed(1);

        stats.avgProjects = calcAvg('projects').toFixed(2);
        // Using a threshold of 2 or more projects as "High Performers"
        stats.highPerformers = COHORT_INTERNS.filter(i => i.projects >= 2).length; 
        
        stats.avgConfidence = calcAvg('confidence').toFixed(2);
        stats.avgMentorRating = calcAvg('mentorRating').toFixed(2);

        // Categorical Distributions
        stats.qualityDist = {
            "Excellent": COHORT_INTERNS.filter(i => i.quality === "Excellent").length,
            "Good": COHORT_INTERNS.filter(i => i.quality === "Good").length,
            "Average": COHORT_INTERNS.filter(i => i.quality === "Average").length,
        };

        stats.slackDist = {
            "Very active": COHORT_INTERNS.filter(i => i.slack === "Very active").length,
            "Active": COHORT_INTERNS.filter(i => i.slack === "Active").length,
            "Somewhat Active": COHORT_INTERNS.filter(i => i.slack === "Somewhat Active").length,
            "Rarely Active": COHORT_INTERNS.filter(i => i.slack === "Rarely Active").length,
        };

        stats.assignmentDist = {
            "All (100%)": COHORT_INTERNS.filter(i => i.assignments === "All (100%)").length,
            "Most (75%)": COHORT_INTERNS.filter(i => i.assignments === "Most (75%)").length,
            "Some (50%)": COHORT_INTERNS.filter(i => i.assignments === "Some (50%)").length,
            "None": COHORT_INTERNS.filter(i => i.assignments === "None").length,
        };
        
        stats.feedbackSummary = {
            challenges: COHORT_INTERNS
                .filter(i => i.challenge && i.challenge.trim() !== "" && i.challenge.toLowerCase() !== "nil")
                .map(i => `• ${i.name}: ${i.challenge}`),
            achievements: COHORT_INTERNS
                .filter(i => i.achievement && i.achievement.trim() !== "")
                .map(i => `• ${i.name}: ${i.achievement}`),
            comments: COHORT_INTERNS
                .filter(i => i.comments && i.comments.trim() !== "")
                .map(i => `• ${i.name}: ${i.comments}`)
        };

        return stats;
    }

    // --- DOM Rendering Functions ---

    function renderHeaderStats(stats) {
        const container = document.getElementById('header-stats');
        container.innerHTML = `
            <div class="bg-indigo-50 px-4 py-2 rounded-lg">
                <span class="text-sm text-indigo-600 font-semibold">Total Interns: ${stats.total}</span>
            </div>
            <div class="bg-green-50 px-4 py-2 rounded-lg">
                <span class="text-sm text-green-600 font-semibold">Avg Projects: ${stats.avgProjects}</span>
            </div>
            <div class="bg-purple-50 px-4 py-2 rounded-lg">
                <span class="text-sm text-purple-600 font-semibold">High Performers (2+ projects): ${stats.highPerformers}</span>
            </div>
        `;
    }

    // --- Overview Tab Rendering ---
    
    function renderOverviewMetrics(stats) {
        const container = document.getElementById('key-metrics');
        // Swapping out the 4 existing skills for new ones
        container.innerHTML = `
            ${renderMetricCard('Data Prep Proficiency', stats.dataPrepAfterAvg, stats.dataPrepImprovement, 'indigo')}
            ${renderMetricCard('Analysis Proficiency', stats.analysisAfterAvg, stats.analysisImprovement, 'blue')}
            ${renderMetricCard('Visualization Proficiency', stats.visualizationAfterAvg, stats.visualizationImprovement, 'purple')}
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-sm font-semibold text-gray-600 mb-2">Avg Confidence</h3>
                <div class="text-3xl font-bold text-green-600">${stats.avgConfidence}/10</div>
                <div class="text-sm mt-2 text-gray-600">
                    Mentor Rating: ${stats.avgMentorRating}/10
                </div>
            </div>
        `;

        function renderMetricCard(title, value, improvement, color) {
            const isPositive = parseFloat(improvement) >= 0;
            const sign = isPositive ? '+' : '';
            const textColor = isPositive ? 'text-green-600' : 'text-red-600';

            return `
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-sm font-semibold text-gray-600 mb-2">${title}</h3>
                    <div class="text-3xl font-bold text-${color}-600">${value}/10</div>
                    <div class="text-sm mt-2 ${textColor}">
                        ${sign}${improvement}% change
                    </div>
                </div>
            `;
        }
    }

    function renderSkillsComparisonChart(stats) {
        const data = [
            { skill: 'Data Prep', Before: parseFloat(stats.dataPrepBeforeAvg), After: parseFloat(stats.dataPrepAfterAvg) },
            { skill: 'Analysis', Before: parseFloat(stats.analysisBeforeAvg), After: parseFloat(stats.analysisAfterAvg) },
            { skill: 'Visualization', Before: parseFloat(stats.visualizationBeforeAvg), After: parseFloat(stats.visualizationAfterAvg) },
            { skill: 'P. Solving', Before: parseFloat(stats.problemSolvingBeforeAvg), After: parseFloat(stats.problemSolvingAfterAvg) },
            { skill: 'Communication', Before: parseFloat(stats.communicationBeforeAvg), After: parseFloat(stats.communicationAfterAvg) },
        ];

        const ctx = document.getElementById('skillComparisonChart').getContext('2d');
        if (chartInstances.skillComparison) chartInstances.skillComparison.destroy();

        chartInstances.skillComparison = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.map(d => d.skill),
                datasets: [
                    {
                        label: 'Before',
                        data: data.map(d => d.Before),
                        backgroundColor: '#94a3b8', // Tailwind gray-400
                        borderRadius: 4,
                    },
                    {
                        label: 'After',
                        data: data.map(d => d.After),
                        backgroundColor: '#3b82f6', // Tailwind blue-500
                        borderRadius: 4,
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 10,
                        title: { display: true, text: 'Rating (0-10)' }
                    }
                }
            }
        });
    }

    function renderImprovementChart(stats) {
        const data = [
            { skill: 'Data Prep', improvement: parseFloat(stats.dataPrepImprovement) },
            { skill: 'Analysis', improvement: parseFloat(stats.analysisImprovement) },
            { skill: 'Visualization', improvement: parseFloat(stats.visualizationImprovement) },
            { skill: 'P. Solving', improvement: parseFloat(stats.problemSolvingImprovement) },
            { skill: 'Communication', improvement: parseFloat(stats.communicationImprovement) },
        ];

        const ctx = document.getElementById('improvementChart').getContext('2d');
        if (chartInstances.improvement) chartInstances.improvement.destroy();

        chartInstances.improvement = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.map(d => d.skill),
                datasets: [
                    {
                        label: 'Improvement Percentage',
                        data: data.map(d => d.improvement),
                        backgroundColor: (context) => {
                            const value = context.parsed.y;
                            return value >= 0 ? '#10b981' : '#ef4444'; // green-500 or red-500
                        },
                        borderRadius: 4,
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (context) => `${context.dataset.label}: ${context.parsed.y}%`
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        title: { display: true, text: 'Percentage Improvement (%)' }
                    }
                }
            }
        });
    }

    function renderOverviewTab(stats) {
        renderOverviewMetrics(stats);
        renderSkillsComparisonChart(stats);
        renderImprovementChart(stats);
    }

    // --- Numerical Tab Rendering ---

    function renderNumericalTable(interns) {
        const tbody = document.getElementById('skills-table-body');
        tbody.innerHTML = interns.map((intern, idx) => {
            const fields = ['dataPrep', 'analysis', 'visualization', 'problemSolving', 'communication'];
            let rowHtml = `<tr class="hover:bg-gray-50 border-b border-gray-100">`;
            rowHtml += `<td class="px-4 py-3 font-medium text-gray-900">${intern.name}</td>`;

            fields.forEach(f => {
                const before = intern[`${f}Before`];
                const after = intern[`${f}After`];
                const change = after - before;
                const changeSign = change >= 0 ? '+' : '';
                const changeColor = change >= 0 ? 'text-green-600' : 'text-red-600';
                
                rowHtml += `
                    <td class="px-4 py-3 text-center">
                        <span class="${changeColor}">
                            ${before}→${after} (${changeSign}${change})
                        </span>
                    </td>
                `;
            });

            // Using 2+ projects as the high threshold since the new data only shows '1' project for all.
            const projectBg = intern.projects >= 2 ? 'bg-green-100 text-green-800' :
                              intern.projects >= 1 ? 'bg-blue-100 text-blue-800' :
                              'bg-yellow-100 text-yellow-800';

            rowHtml += `
                <td class="px-4 py-3 text-center">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold ${projectBg}">
                        ${intern.projects}
                    </span>
                </td>
                <td class="px-4 py-3 text-center font-semibold">
                    ${intern.confidence || 'N/A'}
                </td>
            </tr>`;
            return rowHtml;
        }).join('');
    }

    function renderNumericalSummary(stats) {
        const container = document.getElementById('summary-stats-grid');
        const summaryData = [
            { title: 'Data Prep Avg Growth', value: stats.dataPrepImprovement, before: stats.dataPrepBeforeAvg, after: stats.dataPrepAfterAvg, color: 'blue' },
            { title: 'Analysis Avg Growth', value: stats.analysisImprovement, before: stats.analysisBeforeAvg, after: stats.analysisAfterAvg, color: 'indigo' },
            { title: 'Visualization Avg Growth', value: stats.visualizationImprovement, before: stats.visualizationBeforeAvg, after: stats.visualizationAfterAvg, color: 'purple' },
            { title: 'P. Solving Avg Growth', value: stats.problemSolvingImprovement, before: stats.problemSolvingBeforeAvg, after: stats.problemSolvingAfterAvg, color: 'green' },
            { title: 'Communication Growth', value: stats.communicationImprovement, before: stats.communicationBeforeAvg, after: stats.communicationAfterAvg, color: 'amber' },
            { title: 'Avg Confidence', value: `${stats.avgConfidence}/10`, before: 'Job readiness perception', after: '', color: 'pink' },
        ];

        container.innerHTML = summaryData.map(item => `
            <div class="bg-${item.color}-50 rounded-lg p-4 transition duration-300 hover:shadow-md">
                <div class="text-sm text-${item.color}-600 font-semibold mb-1">${item.title}</div>
                <div class="text-2xl font-bold text-${item.color}-900">${item.value}${item.title.includes('Growth') ? '%' : ''}</div>
                <div class="text-xs text-${item.color}-600">
                    ${item.after ? `${item.before} → ${item.after}` : item.before}
                </div>
            </div>
        `).join('');
    }

    function renderNumericalTab(stats) {
        renderNumericalTable(COHORT_INTERNS);
        renderNumericalSummary(stats);
    }

    // --- Categorical Tab Rendering ---

    function renderPieChart(elementId, title, labels, data, colors) {
        const ctx = document.getElementById(elementId).getContext('2d');
        if (chartInstances[elementId]) chartInstances[elementId].destroy();

        chartInstances[elementId] = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    label: title,
                    data: data,
                    backgroundColor: colors,
                    hoverOffset: 10,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                    },
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const label = context.label || '';
                                const value = context.raw;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percent = ((value / total) * 100).toFixed(0);
                                return `${label}: ${value} (${percent}%)`;
                            }
                        }
                    }
                }
            }
        });
    }

    function renderBarChart(elementId, title, labels, data, color) {
        const ctx = document.getElementById(elementId).getContext('2d');
        if (chartInstances[elementId]) chartInstances[elementId].destroy();

        chartInstances[elementId] = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Number of Interns',
                        data: data,
                        backgroundColor: color,
                        borderRadius: 6,
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    title: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        precision: 0,
                        ticks: { stepSize: 1 }
                    }
                }
            }
        });
    }

    function renderCategoricalCharts(stats) {
        // Project Value Perception Pie Chart (uses the 'qualityDist' from new data)
        const qualityLabels = Object.keys(stats.qualityDist);
        const qualityData = Object.values(stats.qualityDist);
        renderPieChart('qualityPieChart', 'Project Value Perception', qualityLabels, qualityData, [COLORS[0], COLORS[1], COLORS[2]]);

        // Slack Bar Chart
        const slackLabels = Object.keys(stats.slackDist);
        const slackData = Object.values(stats.slackDist);
        renderBarChart('slackBarChart', 'Slack Engagement Levels', slackLabels, slackData, COLORS[1]);

        // Assignment Bar Chart
        const assignmentLabels = Object.keys(stats.assignmentDist);
        const assignmentData = Object.values(stats.assignmentDist);
        renderBarChart('assignmentBarChart', 'Assignment Submission Rates', assignmentLabels, assignmentData, COLORS[0]);

        // Categorical Table
        const tbody = document.getElementById('categorical-table-body');
        tbody.innerHTML = COHORT_INTERNS.map((intern, idx) => {
            const qualityBg = intern.quality === "Excellent" ? 'bg-green-100 text-green-800' :
                              intern.quality === "Good" ? 'bg-blue-100 text-blue-800' :
                              'bg-yellow-100 text-yellow-800';
            
            return `
                <tr class="hover:bg-gray-50 border-b border-gray-100">
                    <td class="px-4 py-3 font-medium text-gray-900">${intern.name}</td>
                    <td class="px-4 py-3 text-center">
                        <span class="inline-flex items-center px-2 py-1 rounded text-xs font-semibold ${qualityBg}">
                            ${intern.quality}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-center text-gray-700">${intern.slack}</td>
                    <td class="px-4 py-3 text-center text-gray-700">${intern.assignments}</td>
                    <td class="px-4 py-3 text-center font-semibold">${intern.mentorRating || 'N/A'}</td>
                </tr>
            `;
        }).join('');
    }

    function renderCategoricalTab(stats) {
        renderCategoricalCharts(stats);
    }

    // --- Feedback Tab Rendering ---

    function renderFeedbackList(listId, items) {
        const list = document.getElementById(listId);
        list.innerHTML = items.map(item => `<li class="text-sm text-gray-700 leading-relaxed p-2 border-l-4 border-gray-200">${item.replace('• ', '').trim()}</li>`).join('');
    }

    function renderFeedbackTab(stats) {
        renderFeedbackList('challenges-list', stats.feedbackSummary.challenges);
        renderFeedbackList('achievements-list', stats.feedbackSummary.achievements);
        renderFeedbackList('comments-list', stats.feedbackSummary.comments);
    }


    // --- Tab Switching and Main App Controller ---

    function switchTab(tabName) {
        // Update active tab state
        activeTab = tabName;

        // Update button styles
        document.querySelectorAll('.tab-button').forEach(button => {
            const isCurrent = button.getAttribute('data-tab') === tabName;
            button.classList.toggle('border-indigo-600', isCurrent);
            button.classList.toggle('text-indigo-600', isCurrent);
            button.classList.toggle('text-gray-600', !isCurrent);
            button.classList.toggle('hover:text-gray-900', !isCurrent);
            button.classList.toggle('hover:border-b-2', !isCurrent);
            button.classList.toggle('hover:border-gray-200', !isCurrent);
            button.classList.toggle('border-b-2', isCurrent);
        });

        // Hide all content and show the active one
        document.querySelectorAll('[data-tab-content]').forEach(content => {
            if (content.id === tabName) {
                content.classList.remove('hidden');
                // Re-render charts when switching to ensure they resize correctly
                if (tabName === 'overview') {
                    renderOverviewTab(globalStats);
                } else if (tabName === 'categorical') {
                    renderCategoricalTab(globalStats);
                }
            } else {
                content.classList.add('hidden');
            }
        });
    }

    function initEventListeners() {
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', (e) => {
                switchTab(e.target.getAttribute('data-tab'));
            });
        });

        // Handle window resize for Chart.js responsiveness (Chart.js handles this internally, but it's good practice to ensure DOM elements are properly sized)
        window.addEventListener('resize', () => {
            if (activeTab === 'overview') {
                renderOverviewTab(globalStats);
            } else if (activeTab === 'categorical') {
                renderCategoricalTab(globalStats);
            }
        });
    }

    function initApp() {
        // 1. Calculate all necessary statistics once
        globalStats = calculateStats();

        // 2. Render initial static data (Header)
        renderHeaderStats(globalStats);
        
        // 3. Render all tabs initially (only the active one will be visible)
        // Note: Charts are rendered here to ensure they are drawn when the DOM is ready.
        renderOverviewTab(globalStats);
        renderNumericalTab(globalStats);
        renderCategoricalTab(globalStats);
        renderFeedbackTab(globalStats);

        // 4. Set the initial active tab (Overview is set by default in HTML, but this confirms it)
        switchTab('overview');

        // 5. Setup event listeners
        initEventListeners();
    }

    // Initialize the application when the window loads
    window.onload = initApp;

</script>

</body>
</html>